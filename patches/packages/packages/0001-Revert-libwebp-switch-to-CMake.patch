From 3eafe6ae5aff9208c247ebcf8b7ee3ecd0b6684e Mon Sep 17 00:00:00 2001
From: adminuser <adminuser@cvt.bln.roederer.dhs.org>
Date: Sat, 16 May 2020 20:40:49 +0200
Subject: [PATCH] Revert "libwebp: switch to CMake"

This reverts commit 61efe7dc3e58987a99d6f1db227b9bd809a96520.
---
 libs/libwebp/Makefile | 43 ++++++++++++++++++++++++++++---------------
 1 file changed, 28 insertions(+), 15 deletions(-)

diff --git a/libs/libwebp/Makefile b/libs/libwebp/Makefile
index bb0ce974b..d68083247 100644
--- a/libs/libwebp/Makefile
+++ b/libs/libwebp/Makefile
@@ -12,11 +12,10 @@ PKG_MAINTAINER:=
 PKG_LICENSE:=BSD-3-Clause
 PKG_LICENSE_FILES:=COPYING
 
-CMAKE_INSTALL:=1
+PKG_INSTALL:=1
 PKG_BUILD_PARALLEL:=1
 
 include $(INCLUDE_DIR)/package.mk
-include $(INCLUDE_DIR)/cmake.mk
 
 define Package/libwebp
   SECTION:=libs
@@ -29,19 +28,33 @@ define Package/libwebp/description
   The libwebp package contains a library for the WebP format.
 endef
 
-CMAKE_OPTIONS += \
-	-DBUILD_SHARED_LIBS=ON \
-	-DWEBP_BUILD_ANIM_UTILS=OFF \
-	-DWEBP_BUILD_CWEBP=OFF \
-	-DWEBP_BUILD_DWEBP=OFF \
-	-DWEBP_BUILD_GIF2WEBP=OFF \
-	-DWEBP_BUILD_IMG2WEBP=OFF \
-	-DWEBP_BUILD_VWEBP=OFF \
-	-DWEBP_BUILD_WEBPINFO=OFF \
-	-DWEBP_BUILD_WEBPMUX=OFF \
-	-DWEBP_BUILD_EXTRAS=OFF
-
-TARGET_CFLAGS += -flto
+CONFIGURE_ARGS += \
+	--enable-shared \
+	--disable-static \
+	--disable-neon-rtcd \
+	--disable-gl \
+	--disable-sdl \
+	--disable-gif \
+	--disable-jpeg \
+	--disable-png \
+	--disable-tiff \
+	--disable-wic \
+	--disable-libwebpmux \
+	--disable-libwebpdemux \
+	--disable-libwebpdecoder \
+	--disable-libwebpextras \
+	--without-pic
+
+TARGET_CFLAGS += $(FPIC) -flto
+
+define Build/InstallDev
+	$(INSTALL_DIR) $(1)/usr/include/webp
+	$(INSTALL_DATA) $(PKG_INSTALL_DIR)/usr/include/webp/* $(1)/usr/include/webp/
+	$(INSTALL_DIR) $(1)/usr/lib
+	$(CP) $(PKG_INSTALL_DIR)/usr/lib/libwebp* $(1)/usr/lib/
+	$(INSTALL_DIR) $(1)/usr/lib/pkgconfig
+	$(INSTALL_DATA) $(PKG_INSTALL_DIR)/usr/lib/pkgconfig/libwebp.pc $(1)/usr/lib/pkgconfig/
+endef
 
 define Package/libwebp/install
 	$(INSTALL_DIR) $(1)/usr/lib
-- 
2.20.1

